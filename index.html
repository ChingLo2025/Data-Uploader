<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>檔案上傳（限制 200 KB）</title>

    <!-- File Uploader 的樣式 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/uc-file-uploader-regular.min.css"
    />

    <!-- File Uploader 元件本體 -->
    <script type="module">
      import * as UC from "https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/uc-file-uploader-regular.min.js";
      UC.defineComponents(UC);
    </script>

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        padding: 40px;
      }
      #result {
        margin-top: 20px;
        font-size: 14px;
        word-break: break-all;
      }
      .error {
        color: #c00;
      }
      .ok {
        color: #060;
      }
    </style>
  </head>
  <body>
    <h1>檔案上傳 Demo（每個檔案 &lt; 200 KB）</h1>

    <!-- 設定區：這裡放限制條件 -->
    <uc-config
      ctx-name="my-uploader"
      pubkey="你的_public_key_放這裡"
      max-local-file-size-bytes="204800"  <!-- 200 KB ≈ 200 * 1024 -->
      multiple="false"
    >
    </uc-config>

    <!-- 事件會從這個 context provider 發出 -->
    <uc-upload-ctx-provider ctx-name="my-uploader"></uc-upload-ctx-provider>

    <!-- 實際的 Uploader UI -->
    <uc-file-uploader-regular ctx-name="my-uploader"></uc-file-uploader-regular>

    <!-- 顯示結果 -->
    <div id="result"></div>

    <script>
      const ctx = document.querySelector("uc-upload-ctx-provider");
      const resultDiv = document.getElementById("result");

      // 成功上傳事件
      ctx.addEventListener("file-upload-success", (e) => {
        const entry = e.detail; // OutputFileEntry
        resultDiv.innerHTML =
          `<div class="ok">上傳成功：${entry.name} (${Math.round(
            entry.size / 1024
          )} KB)<br>CDN URL：${entry.cdnUrl}</div>`;
      });

      // 上傳失敗事件（包括超過檔案大小）
      ctx.addEventListener("file-upload-failed", (e) => {
        const entry = e.detail;
        const sizeKB = Math.round(entry.size / 1024);

        // 檔案大小錯誤會出現在 entry.errors 裡
        const sizeError = entry.errors?.find(
          (err) => err.type === "FILE_SIZE_EXCEEDED"
        );

        if (sizeError) {
          resultDiv.innerHTML = `
            <div class="error">
              檔案太大了：${entry.name} (${sizeKB} KB)<br>
              限制為 &lt; 200 KB，已經在本機端被阻擋，沒有上傳到伺服器。
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="error">
              上傳失敗：${entry.name || "未知檔案"}<br>
              錯誤類型：${
                entry.errors?.map((e) => e.type).join(", ") || "未知"
              }
            </div>
          `;
        }
      });
    </script>
  </body>
</html>
