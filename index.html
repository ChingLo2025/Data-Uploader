<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>File Upload Demo</title>

  <script>
    UPLOADCARE_PUBLIC_KEY = "e4da8b17a138c42b9081";
  </script>
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>

  <style>
    body {
      font-family: Arial;
      margin: 40px;
    }
    #error {
      color: red;
      margin-top: 10px;
      display: none;
    }
    #result {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      display: none;
    }
  </style>
</head>

<body>

  <h2>限制 200 KB 檔案上傳（完整阻擋版）</h2>

  <!-- Uploadcare widget -->
  <input
    type="hidden"
    role="uploadcare-uploader"
    data-clearable="true"
    data-multiple="false"
  />

  <div id="error">❌ 檔案太大，必須小於 200 KB！</div>

  <div id="result">
    <h3>上傳成功！</h3>
    <p>檔案 URL：</p>
    <a id="fileUrl" href="#" target="_blank"></a>
  </div>

  <script>
    const MAX_SIZE = 200 * 1024; // 200 KB
    const widget = uploadcare.Widget('[role=uploadcare-uploader]');

    widget.onChange(file => {
      if (!file) return;

      file.done(fileInfo => {
        if (fileInfo.size > MAX_SIZE) {
          document.getElementById("error").style.display = "block";
          widget.value(null);   // 清除 widget
        } else {
          document.getElementById("error").style.display = "none";
        }
      });
    });

    widget.onUploadComplete(info => {
      document.getElementById("result").style.display = "block";
      document.getElementById("fileUrl").href = info.cdnUrl;
      document.getElementById("fileUrl").textContent = info.cdnUrl;
    });
  </script>

</body>
</html>
