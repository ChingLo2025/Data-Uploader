<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>檔案上傳（限制 200 KB）</title>

    <!-- File Uploader 的樣式 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/uc-file-uploader-regular.min.css"
    />

    <!-- File Uploader 元件本體 -->
    <script type="module">
      import * as UC from "https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@v1/web/uc-file-uploader-regular.min.js";
      UC.defineComponents(UC);
    </script>

    <style>
      :root {
        --bg: #f2f5fb;
        --text: #1f2933;
        --card: #ffffff;
        --accent: #3b82f6;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg);
        color: var(--text);
        padding: 24px;
        box-sizing: border-box;
      }

      .card {
        background: var(--card);
        width: min(680px, 100%);
        padding: 32px;
        border-radius: 18px;
        box-shadow: 0 10px 45px rgba(0, 0, 0, 0.08);
      }

      h1 {
        margin: 0 0 20px;
        text-align: center;
        font-weight: 700;
        letter-spacing: 0.01em;
      }

      uc-file-uploader-regular,
      uc-config,
      uc-upload-ctx-provider {
        display: block;
      }

      uc-file-uploader-regular {
        margin-top: 8px;
      }

      #result {
        margin-top: 20px;
        font-size: 14px;
        word-break: break-all;
        text-align: center;
        line-height: 1.6;
      }
      .error {
        color: #c00;
      }
      .ok {
        color: #060;
      }

      .result-link {
        display: inline-block;
        margin-top: 8px;
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
      }

      .result-link:hover,
      .result-link:focus {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <main class="card">
      <h1>檔案上傳 Demo（每個檔案 &lt; 200 KB）</h1>

      <!-- 設定區：這裡放限制條件 -->
      <!-- 200 KB ≈ 200 * 1024 -->
      <uc-config
        ctx-name="my-uploader"
        pubkey="e4da8b17a138c42b9081"
        max-local-file-size-bytes="204800"
        multiple="false"
      >
      </uc-config>

      <!-- 事件會從這個 context provider 發出 -->
      <uc-upload-ctx-provider ctx-name="my-uploader"></uc-upload-ctx-provider>

      <!-- 實際的 Uploader UI -->
      <uc-file-uploader-regular ctx-name="my-uploader"></uc-file-uploader-regular>

      <!-- 顯示結果 -->
      <div id="result"></div>
    </main>

    <script>
      const ctx = document.querySelector("uc-upload-ctx-provider");
      const resultDiv = document.getElementById("result");

      // 成功上傳事件
      ctx.addEventListener("file-upload-success", (e) => {
        const entry = e.detail; // OutputFileEntry
        resultDiv.innerHTML =
          `<div class="ok">上傳成功：${entry.name} (${Math.round(
            entry.size / 1024
          )} KB)</div>
          <a class="result-link" href="${entry.cdnUrl}" target="_blank" rel="noopener noreferrer">
            查看 CDN 連結
          </a>`;
      });

      // 上傳失敗事件（包括超過檔案大小）
      ctx.addEventListener("file-upload-failed", (e) => {
        const entry = e.detail;
        const sizeKB = Math.round(entry.size / 1024);

        // 檔案大小錯誤會出現在 entry.errors 裡
        const sizeError = entry.errors?.find(
          (err) => err.type === "FILE_SIZE_EXCEEDED"
        );

        if (sizeError) {
          resultDiv.innerHTML = `
            <div class="error">
              檔案太大了：${entry.name} (${sizeKB} KB)<br>
              限制為 &lt; 200 KB，已經在本機端被阻擋，沒有上傳到伺服器。
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="error">
              上傳失敗：${entry.name || "未知檔案"}<br>
              錯誤類型：${
                entry.errors?.map((e) => e.type).join(", ") || "未知"
              }
            </div>
          `;
        }
      });
    </script>
  </body>
</html>
